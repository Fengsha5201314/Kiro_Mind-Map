# AI思维导图生成器 v2.0 优化需求文档

## 项目概述

本文档定义了AI思维导图生成器v2.0版本的三项核心优化功能，旨在提升AI生成质量、用户体验和视觉呈现效果。

## 优化目标

将当前1.0版本升级为商业级产品，重点优化：
1. **智能提示词工程** - 提升AI生成质量和准确性
2. **流式生成** - 改善用户体验，提供实时反馈
3. **多种布局模式** - 增强视觉表现力和适用场景

---

## 需求1：智能提示词工程

**用户故事：** 作为用户，我希望AI能够根据不同类型的输入内容生成更准确、更结构化的思维导图，以便更好地理解和组织信息。

### 验收标准

1.1 **内容类型识别**
- WHEN 用户上传文档或输入文本 THEN 系统应自动识别内容类型（技术文档、会议记录、学习笔记、项目计划等）
- WHEN 内容类型被识别 THEN 系统应在UI上显示识别结果供用户确认或修改

1.2 **动态提示词生成**
- WHEN 系统识别出内容类型 THEN 系统应根据类型选择对应的提示词模板
- WHEN 生成思维导图 THEN 系统应使用优化的提示词，包含MECE原则、金字塔原理等结构化要求
- WHEN 处理技术文档 THEN 提示词应强调概念层次、API结构、代码示例等
- WHEN 处理会议记录 THEN 提示词应强调议题、决策、行动项等

1.3 **提示词模板管理**
- WHEN 开发者需要添加新模板 THEN 系统应提供清晰的模板定义接口
- WHEN 用户选择不同内容类型 THEN 系统应能够切换对应的提示词策略

1.4 **质量保证**
- WHEN AI生成结果 THEN 结果应遵循MECE原则（相互独立、完全穷尽）
- WHEN 生成多层级结构 THEN 应遵循金字塔原理（结论先行、以上统下）

---

## 需求2：流式生成

**用户故事：** 作为用户，我希望在AI生成思维导图时能够实时看到生成进度和中间结果，而不是等待整个过程完成，以便更好地了解生成状态并提前预览结果。

### 验收标准

2.1 **流式API调用**
- WHEN 用户触发生成操作 THEN 系统应使用Gemini的流式API（streamGenerateContent）
- WHEN 接收到流式数据 THEN 系统应能够解析部分JSON响应
- WHEN API返回错误 THEN 系统应优雅降级到非流式模式

2.2 **实时节点渲染**
- WHEN 接收到新的节点数据 THEN 系统应立即在画布上渲染该节点
- WHEN 节点逐步生成 THEN 画布应自动调整布局以容纳新节点
- WHEN 生成过程中 THEN 应显示"正在生成..."的动画效果

2.3 **进度反馈**
- WHEN 流式生成开始 THEN 应显示进度指示器
- WHEN 生成每个主要分支 THEN 进度应相应更新
- WHEN 生成完成 THEN 应显示完成提示并移除进度指示器

2.4 **用户交互**
- WHEN 流式生成进行中 THEN 用户应能够取消操作
- WHEN 用户取消生成 THEN 已生成的部分应保留并可编辑
- WHEN 生成完成 THEN 用户应能够立即编辑结果

---

## 需求3：多种布局模式

**用户故事：** 作为用户，我希望能够选择不同的思维导图布局样式，以适应不同的内容类型和展示需求，使信息呈现更加清晰和美观。

### 验收标准

3.1 **布局模式选择**
- WHEN 用户查看思维导图 THEN 应提供布局模式切换按钮
- WHEN 用户点击布局按钮 THEN 应显示可用布局模式列表（水平树形、垂直树形、辐射状、鱼骨图）
- WHEN 用户选择布局模式 THEN 思维导图应平滑过渡到新布局

3.2 **水平树形布局（默认）**
- WHEN 使用水平树形布局 THEN 根节点应位于左侧，子节点向右展开
- WHEN 节点有多个子节点 THEN 子节点应垂直对称分布
- WHEN 层级较深 THEN 应动态调整节点间距

3.3 **垂直树形布局**
- WHEN 使用垂直树形布局 THEN 根节点应位于顶部，子节点向下展开
- WHEN 节点有多个子节点 THEN 子节点应水平对称分布
- WHEN 适用于组织架构图等场景 THEN 布局应清晰展示层级关系

3.4 **辐射状布局**
- WHEN 使用辐射状布局 THEN 根节点应位于中心，子节点环绕分布
- WHEN 子节点数量较多 THEN 应均匀分布在圆周上
- WHEN 适用于头脑风暴等场景 THEN 布局应强调中心主题

3.5 **鱼骨图布局**
- WHEN 使用鱼骨图布局 THEN 主题应位于右侧，分支向左展开
- WHEN 适用于因果分析 THEN 主要分支应分布在主干上下两侧
- WHEN 子分支存在 THEN 应以斜线形式连接到主分支

3.6 **布局持久化**
- WHEN 用户切换布局 THEN 布局选择应保存到思维导图数据中
- WHEN 重新加载思维导图 THEN 应恢复上次使用的布局模式

---

## 优先级排序

### P0 - 必须实现（本次迭代）
1. **智能提示词工程** - 核心功能，直接影响生成质量
2. **流式生成** - 显著提升用户体验
3. **多种布局模式** - 增强产品竞争力

### 实施顺序建议

**第一阶段：智能提示词工程（2-3天）**
- 实现内容类型识别
- 创建提示词模板系统
- 优化现有提示词

**第二阶段：流式生成（3-4天）**
- 集成Gemini流式API
- 实现实时渲染
- 添加进度反馈

**第三阶段：多种布局模式（3-4天）**
- 实现布局算法
- 添加布局切换UI
- 优化布局动画

---

## 技术约束

1. 必须兼容现有的Gemini API集成
2. 必须保持现有的数据结构兼容性
3. 必须支持现有的导出功能
4. 性能要求：流式生成延迟 < 500ms，布局切换动画 < 300ms

---

## 成功指标

1. **智能提示词**：AI生成的思维导图结构化程度提升50%
2. **流式生成**：用户感知的等待时间减少70%
3. **布局模式**：用户满意度提升，支持4种以上布局模式

---

## 附录：术语表

- **MECE原则**：Mutually Exclusive, Collectively Exhaustive（相互独立，完全穷尽）
- **金字塔原理**：结论先行，以上统下，归类分组，逻辑递进
- **流式生成**：Streaming Generation，实时返回生成结果的技术
- **布局算法**：Layout Algorithm，计算节点位置的数学算法
