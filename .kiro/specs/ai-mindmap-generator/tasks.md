# 实现计划

- [x] 1. 项目初始化和基础架构
- [x] 1.1 创建Vite + React + TypeScript项目
  - 使用Vite创建项目脚手架
  - 配置TypeScript和ESLint
  - 安装核心依赖：React 18、ReactFlow、Zustand、Tailwind CSS
  - _需求: 所有需求的基础_

- [x] 1.2 配置项目结构
  - 创建src目录结构（components、services、stores、types、utils）
  - 配置Tailwind CSS
  - 设置路径别名
  - _需求: 所有需求的基础_

- [x] 1.3 创建类型定义
  - 编写mindmap.ts类型定义（MindMapNode、MindMapData等）
  - 编写api.ts类型定义（GeminiService接口等）
  - 编写storage.ts类型定义（StorageService接口等）
  - _需求: 1.1, 2.1, 3.1_

- [x] 2. 实现存储服务
- [x] 2.1 实现LocalStorage工具函数
  - 编写加密/解密工具（crypto.ts）
  - 实现API密钥的加密存储和读取
  - 实现设置数据的存储
  - _需求: 2.2, 2.5_

- [ ]* 2.2 编写属性测试：API密钥存储往返一致性
  - **属性 2: API密钥存储往返一致性**
  - **验证需求: 2.2**

- [x] 2.3 实现IndexedDB服务
  - 创建IndexedDB数据库和对象存储
  - 实现思维导图的CRUD操作
  - 实现历史记录查询
  - _需求: 7.1, 7.2, 7.3, 7.4_

- [ ]* 2.4 编写属性测试：思维导图保存往返一致性
  - **属性 17: 思维导图保存往返一致性**
  - **验证需求: 7.1, 7.3**

- [x] 3. 实现文件解析服务
- [x] 3.1 实现PDF文本提取
  - 集成pdfjs-dist库
  - 实现PDF文件解析函数
  - 处理PDF解析错误
  - _需求: 1.2_

- [x] 3.2 实现Word文档解析
  - 集成mammoth库
  - 实现Word文档解析函数
  - 处理Word解析错误
  - _需求: 1.3_

- [x] 3.3 实现Markdown和文本文件解析
  - 实现Markdown文件解析
  - 实现纯文本文件读取
  - 实现文件类型检测函数
  - _需求: 1.4, 1.5_

- [ ]* 3.4 编写属性测试：文件解析保持内容完整性
  - **属性 1: 文件解析保持内容完整性**
  - **验证需求: 1.2, 1.3, 1.4, 1.5**

- [x] 4. 实现Gemini AI服务
- [x] 4.1 集成Gemini API SDK
  - 安装@google/generative-ai包
  - 创建Gemini服务类
  - 实现API密钥验证
  - _需求: 2.1, 3.1_

- [x] 4.2 实现思维导图生成功能
  - 编写结构化提示词模板
  - 实现generateMindMap函数
  - 实现generateFromTopic函数
  - 解析AI响应并转换为MindMapData结构
  - _需求: 3.1, 3.2, 3.3, 9.3_

- [ ]* 4.3 编写属性测试：Gemini API请求格式正确性
  - **属性 5: Gemini API请求格式正确性**
  - **验证需求: 3.2**

- [ ]* 4.4 编写属性测试：AI响应解析有效性
  - **属性 6: AI响应解析有效性**
  - **验证需求: 3.3**

- [ ]* 4.5 编写属性测试：主题生成结构有效性
  - **属性 21: 主题生成结构有效性**
  - **验证需求: 9.3**

- [x] 4.7 实现错误处理和重试机制
  - 实现API调用重试逻辑
  - 处理超时和网络错误
  - 实现用户友好的错误消息
  - _需求: 3.4, 3.5, 3.6_

- [x] 5. 实现状态管理
- [x] 5.1 创建MindMap Store
  - 使用Zustand创建思维导图状态管理
  - 实现setMindMap、updateNode等操作
  - 实现addNode、deleteNode、moveNode功能
  - _需求: 5.1, 5.2, 5.4, 5.5, 5.6_

- [ ]* 5.2 编写属性测试：添加子节点增加节点数
  - **属性 12: 添加子节点增加节点数**
  - **验证需求: 5.4**

- [ ]* 5.3 编写属性测试：删除节点移除子树
  - **属性 13: 删除节点移除子树**
  - **验证需求: 5.5**

- [ ]* 5.4 编写属性测试：节点移动更新父子关系
  - **属性 14: 节点移动更新父子关系**
  - **验证需求: 5.6**

- [x] 5.5 创建Settings Store
  - 实现设置状态管理
  - 实现API密钥管理
  - 实现主题切换
  - _需求: 2.1, 2.2, 2.5_

- [x] 5.6 创建History Store
  - 实现历史记录状态管理
  - 实现加载、添加、删除历史记录
  - _需求: 7.2, 7.3, 7.4_

- [ ]* 5.7 编写属性测试：历史记录列表完整性
  - **属性 18: 历史记录列表完整性**
  - **验证需求: 7.2**

- [ ]* 5.8 编写属性测试：历史记录删除一致性
  - **属性 19: 历史记录删除一致性**
  - **验证需求: 7.4**

- [x] 6. 实现UI组件 - 布局
- [x] 6.1 创建基础布局组件
  - 实现Header组件（导航栏）
  - 实现Sidebar组件（历史记录侧边栏）
  - 实现主布局容器
  - _需求: 1.1, 7.2_

- [x] 6.2 创建通用组件
  - 实现Button组件
  - 实现Modal组件
  - 实现Loading组件
  - 实现Toast提示组件
  - _需求: 所有需求_

- [x] 7. 实现UI组件 - 输入
- [x] 7.1 创建文件上传组件
  - 实现FileUploader组件
  - 支持拖拽上传
  - 显示文件类型图标
  - 实现文件验证（大小、类型）
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 1.7_

- [x] 7.2 创建文本输入组件
  - 实现TextInput组件
  - 支持多行文本输入
  - 实现输入验证
  - _需求: 1.6, 1.7_

- [x] 7.3 创建一键生成对话框
  - 实现QuickGenerate组件
  - 支持主题输入
  - 支持选择输入方式
  - _需求: 9.1, 9.2, 9.3, 9.4, 9.5_

- [ ]* 7.4 编写属性测试：文本输入接受一致性
  - **属性 22: 文本输入接受一致性**
  - **验证需求: 1.6, 9.2**

- [x] 8. 实现思维导图画布
- [x] 8.1 集成ReactFlow并创建画布组件
  - 创建Canvas组件
  - 配置ReactFlow基础设置
  - 实现画布控制按钮
  - _需求: 4.1, 4.3, 4.4_

- [x] 8.2 创建自定义节点组件
  - 实现Node组件
  - 支持节点样式定制
  - 实现节点折叠/展开按钮
  - _需求: 4.1, 4.5_

- [ ]* 8.3 编写属性测试：思维导图渲染完整性
  - **属性 7: 思维导图渲染完整性**
  - **验证需求: 4.1**

- [x] 8.4 实现节点交互功能
  - 实现节点点击高亮
  - 实现节点双击编辑
  - 实现节点拖拽
  - _需求: 4.2, 5.1, 5.6_

- [ ]* 8.5 编写属性测试：节点点击高亮一致性
  - **属性 8: 节点点击高亮一致性**
  - **验证需求: 4.2**

- [ ]* 8.6 编写属性测试：视图缩放状态保持
  - **属性 9: 视图缩放状态保持**
  - **验证需求: 4.4**

- [ ]* 8.7 编写属性测试：节点折叠状态切换
  - **属性 10: 节点折叠状态切换**
  - **验证需求: 4.5**

- [ ]* 8.8 编写属性测试：节点编辑保存一致性
  - **属性 11: 节点编辑保存一致性**
  - **验证需求: 5.2**

- [x] 8.9 创建右键菜单
  - 实现ContextMenu组件
  - 添加"添加子节点"选项
  - 添加"删除节点"选项
  - 添加"编辑节点"选项
  - _需求: 5.3, 5.4, 5.5_

- [x] 8.10 检查点 - 核心功能测试
  - 确保所有测试通过，询问用户是否有问题

- [x] 9. 实现设置功能
- [x] 9.1 创建API密钥配置组件
  - 实现ApiKeyConfig组件
  - 实现密钥输入和保存
  - 实现密钥掩码显示
  - 实现密钥删除
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ]* 9.2 编写属性测试：API密钥掩码格式正确性
  - **属性 3: API密钥掩码格式正确性**
  - **验证需求: 2.4**

- [ ]* 9.3 编写属性测试：API密钥删除完整性
  - **属性 4: API密钥删除完整性**
  - **验证需求: 2.5**

- [x] 9.5 创建设置面板
  - 实现SettingsPanel组件
  - 集成API密钥配置
  - 添加主题切换选项
  - _需求: 2.1_

- [x] 9.6 检查点 - 设置功能测试
  - 确保所有测试通过，询问用户是否有问题

- [-] 10. 实现导出功能
- [x] 10.1 实现导出服务
  - 实现exportToPNG函数（使用html2canvas）
  - 实现exportToJSON函数
  - 实现exportToMarkdown函数
  - _需求: 6.2, 6.3, 6.4_

- [ ]* 10.2 编写属性测试：JSON导出往返一致性
  - **属性 15: JSON导出往返一致性**
  - **验证需求: 6.3**

- [ ]* 10.3 编写属性测试：Markdown导出格式正确性
  - **属性 16: Markdown导出格式正确性**
  - **验证需求: 6.4**

- [x] 10.4 创建导出菜单组件
  - 实现ExportMenu组件
  - 添加导出格式选项
  - 处理导出错误
  - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 10.5 检查点 - 导出功能测试
  - 确保所有测试通过，询问用户是否有问题

- [x] 11. 实现完整工作流集成
- [x] 11.1 连接文件上传到AI生成
  - 实现文件上传后自动解析
  - 连接解析结果到Gemini服务
  - 显示生成进度
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 3.1, 3.2_

- [x] 11.2 实现思维导图保存和加载
  - 实现保存当前思维导图
  - 实现从历史记录加载
  - 更新历史记录列表
  - _需求: 7.1, 7.2, 7.3, 7.4_

- [x] 11.3 实现中文界面
  - 确保所有UI文本使用中文
  - 实现日期格式化为中文
  - 实现错误消息中文化
  - _需求: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ]* 11.4 编写属性测试：日期格式化中文正确性
  - **属性 20: 日期格式化中文正确性**
  - **验证需求: 8.5**

- [x] 12. 性能优化
- [x] 12.1 实现虚拟化渲染
  - 为大型思维导图实现视口裁剪
  - 实现节点懒加载
  - _需求: 4.6_

- [x] 12.2 实现防抖和节流
  - 为拖拽操作添加requestAnimationFrame
  - 为搜索输入添加防抖
  - _需求: 10.5_

- [x] 12.3 实现缓存策略
  - 实现文件内容缓存
  - 实现API响应缓存
  - _需求: 10.1_

- [x] 13. 错误处理和用户体验
- [x] 13.1 实现全局错误处理
  - 创建ErrorHandler类
  - 实现各类错误的处理函数
  - 显示用户友好的错误消息
  - _需求: 3.4, 6.5, 10.3_

- [x] 13.2 实现加载状态
  - 为API调用添加加载动画
  - 为文件解析添加进度指示
  - _需求: 10.2_

- [x] 13.3 检查点 - 错误处理和用户体验测试
  - 确保所有测试通过，询问用户是否有问题

- [x] 14. 测试和验证
- [x] 14.1 配置测试环境
  - 安装Vitest和fast-check
  - 配置测试脚本
  - 创建测试工具函数

- [ ]* 14.2 编写单元测试
  - 测试文件解析服务
  - 测试存储服务
  - 测试工具函数
  - 测试思维导图服务

- [x] 14.3 确保所有属性测试通过
  - 运行所有属性测试
  - 修复失败的测试
  - 确保测试覆盖率达标

- [x] 15. 最终检查点
- [x] 15.1 完整功能测试
  - 测试完整的用户工作流
  - 验证所有需求已实现
  - 确保所有测试通过，询问用户是否有问题

- [x] 15.2 构建和部署准备
  - 配置生产环境构建
  - 优化打包大小
  - 准备部署文档
